# SmartDoc PDF Generator

This project creates SmartDoc PDF files based on data from Excel sheets. It consists of two main components:

1. **XLS2CSV**: Excel VBA macro to export data rows to individual CSV files
2. **CSV2PDF**: Python script to convert CSV files to PDF using SmartDoc website automation

## Prerequisites

### For XLS2CSV (Excel Macro)
- Microsoft Excel with VBA support
- The Excel file `input.xlsm` with your data

### For CSV2PDF (Python Script)
- Python 3.7 or higher
- Google Chrome browser
- ChromeDriver (usually auto-managed by Selenium)
- Access to BME network (for SmartDoc website)
- Virtual environment configured with required dependencies

## Installation

### Python Dependencies
1. Configure the Python virtual environment:
   ```bash
   # The project uses a virtual environment at E:\_learning_ai\.venv
   # This should be automatically configured when running the batch file
   ```

2. Install the required Python packages:
   ```bash
   pip install -r requirements.txt
   ```

## Complete Workflow - Running Both Features

### Step 1: XLS2CSV - Export Excel Data to CSV Files

1. Open your Excel file (`input.xlsm`) with your data
2. Make sure your data is structured with:
   - First row: Column headers (matching the SmartDoc template)
   - Subsequent rows: Data for each document to generate
   - One column designated as the "filename column" (contains the name for each CSV file)
   - **Date columns**: Can contain dates in any Excel format - they will be automatically converted to YYYYMMDD format for SmartDoc compatibility

3. Import the VBA macro:
   - Press `Alt + F11` to open VBA Editor
   - Import the `xls2csv.bas` file or copy its content to a new module
   - Run the `RegisterHotkey` macro once to set up the Ctrl+Shift+C shortcut

4. Export CSV files:
   - Click on any cell in the column you want to use as the filename column
   - Press `Ctrl + Shift + C`
   - Select the filename column when prompted
   - The macro will generate individual CSV files for each data row

### Step 2: CSV2PDF - Convert CSV Files to PDF

**Recommended Method: Using the Batch File**

Simply double-click or run:
```batch
run_csv2pdf_venv.bat
```

This batch file will:
- ✅ Automatically navigate to the correct directory
- ✅ Use the proper Python virtual environment
- ✅ Verify all files and dependencies exist
- ✅ Run the CSV2PDF conversion script
- ✅ Show clear error messages if something goes wrong

**Alternative Method: Manual Python Execution**
```bash
# Navigate to the correct directory first
cd "E:\_learning_ai\SmartdocKitolto"
# Use the virtual environment Python
"E:\_learning_ai\.venv\Scripts\python.exe" csv2pdf.py
```

#### How the CSV2PDF Script Works:

The script will:
1. **Setup**: Initialize Chrome WebDriver and connect to SmartDoc website
2. **Discovery**: Find all CSV files in the current directory
3. **Processing**: For each CSV file:
   - Click "Adat export/import" button
   - Paste CSV content into the text field (with proper UTF-8 encoding and BOM handling)
   - **MANUAL STEP**: Wait for you to manually click the "CSV => HTML" button
   - Handle any warning popups automatically
   - Click "PDF letöltése" (Download PDF) button
   - Wait for download to complete
4. **Completion**: Process all CSV files and close browser

**Important Notes:**
- The script includes configurable 5-second delays between operations for stability
- Manual intervention is required for the "CSV => HTML" button click
- All CSV content is properly cleaned of BOM characters before pasting
- Downloads will be saved to the current directory

#### Option A: Using the batch file (Windows) - **RECOMMENDED**
```batch
run_csv2pdf_venv.bat
```

#### Option B: Using Python directly (Advanced Users)
```bash
"E:\_learning_ai\.venv\Scripts\python.exe" csv2pdf.py
```

## File Structure

```
SmartdocKitolto/
├── input.xlsm                  # Your Excel data file
├── xls2csv.bas                 # VBA macro for Excel export
├── csv2pdf.py                  # Python script for PDF conversion
├── requirements.txt            # Python dependencies
├── run_csv2pdf_venv.bat        # Windows batch file for easy CSV2PDF execution
├── run_csv2pdf.ps1             # PowerShell script (alternative)
├── test_csv2pdf.py             # Test script for CSV2PDF functionality
├── test_date_format.py         # Test script for date formatting
├── Minta Béka.csv              # Example CSV files (generated by XLS2CSV)
├── Minta Majom.csv             # Example CSV files (generated by XLS2CSV)
├── Minta Mókus.csv             # Example CSV files (generated by XLS2CSV)
├── __pycache__/                # Python cache directory
└── README.md                   # This file
```

## Virtual Environment

This project uses a Python virtual environment located at:
```
E:\_learning_ai\.venv\
```

The batch file automatically uses this virtual environment, ensuring:
- ✅ Correct Python version and dependencies
- ✅ Isolated package management
- ✅ Consistent execution environment
- ✅ No conflicts with system Python installations

## SmartDoc Website

The script uses the SmartDoc website at:
https://smartdoc.bme.hu/Hallgatoi_munkaszerzodes_gradualisnak/Hallgatoi_munkaszerzodes_gradualisnak.html

**Note**: This website is only accessible from within the BME network.

## Date Formatting

The VBA macro (v2.1) automatically detects and formats date values for SmartDoc compatibility:

- **Input**: Any Excel date format (e.g., "2025-08-22", "22/08/2025", Excel date serial numbers)
- **Output**: YYYYMMDD format (e.g., "20250822")
- **SmartDoc Support**: Compatible with SmartDoc date formats: n, nn, hnn, hhnn, éhhnn, ééhhnn, ééééhhnn, éééé-hh-nn, éééé.hh.nn, éééé. hh. nn

**Example:**
- Excel cell contains: `2025. 08. 22.` or `8/22/2025`
- CSV output: `"20250822"`
- SmartDoc: Correctly interprets the date

## CSV Format

The CSV files use UTF-8 encoding and follow this format:
- Semicolon-separated values (`;`)
- All values enclosed in double quotes (`"`)
- First row: Headers
- Second row: Data values
- UTF-8 encoding (properly handles Hungarian characters: á, é, í, ó, ő, ú, ű, ü)

**Note**: All CSV files must be UTF-8 encoded. The VBA macro (v2.0) automatically exports files in UTF-8 format.

Example:
```csv
"FMZ";"Hallgató neve";"Neptun kódja";"Kar neve"
"12345";"Teszt Elek";"ABC123";"VIK"
```

## Troubleshooting

### Common Issues

1. **SmartDoc website not accessible**
   - Ensure you're connected to the BME network
   - Check if the website URL is still valid

2. **Chrome/ChromeDriver issues**
   - Make sure Google Chrome is installed and updated
   - Selenium will try to auto-manage ChromeDriver
   - If issues persist, manually install ChromeDriver

3. **CSV encoding problems (FIXED)**
   - ✅ BOM (Byte Order Mark) characters are automatically removed
   - ✅ UTF-8 encoding is properly handled by both VBA macro and Python script
   - ✅ Hungarian characters (á, é, í, ó, ő, ú, ű, ü) display correctly
   - If you have old CSV files with encoding issues, regenerate them using the updated Excel macro

4. **Excel macro not working**
   - Enable macros in Excel security settings
   - Make sure VBA is available in your Excel installation
   - Run `RegisterHotkey` macro first to set up the keyboard shortcut

5. **Python script directory/environment issues (FIXED)**
   - ✅ Use `run_csv2pdf_venv.bat` to avoid directory and virtual environment issues
   - ✅ The batch file handles all path and environment setup automatically
   - ✅ Clear error messages if files or environment are missing

6. **Manual intervention required**
   - The script will pause and wait for you to click the "CSV => HTML" button
   - This is intentional for better control and reliability
   - Press Enter in the terminal after clicking the button to continue

### Error Messages

- **"No CSV files found"**: Make sure you have CSV files in the same directory as the script
- **"SmartDoc website is not accessible"**: Check your BME network connection
- **"Chrome WebDriver initialization failed"**: Install or update Google Chrome
- **"csv2pdf.py not found"**: Use the batch file or ensure you're in the correct directory
- **"Virtual environment not found"**: Check that the virtual environment exists at `E:\_learning_ai\.venv`

## Security Notes

- The script opens a web browser and automatically fills forms
- Only use on trusted networks and with legitimate data
- Be aware that the script will download files to your current directory

## Support

For issues related to:
- **SmartDoc website**: Contact BME IT support
- **VBA macro**: Check Excel VBA documentation
- **Python script**: Review error messages and ensure all dependencies are installed
